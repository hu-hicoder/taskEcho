# ğŸ§  æ—¥æœ¬èªã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã®ç’°å¢ƒæ§‹ç¯‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€TaskEchoã‚¢ãƒ—ãƒªã«æ—¥æœ¬èªã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®ç’°å¢ƒæ§‹ç¯‰æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ å‰ææ¡ä»¶

- Flutter SDK ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- Python 3.8ä»¥é™ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- 10GBä»¥ä¸Šã®ç©ºããƒ‡ã‚£ã‚¹ã‚¯å®¹é‡

---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ãƒ¢ãƒ‡ãƒ«ã¨ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

```bash
cd /Users/mikayu/developing/taskEcho/front_end/scripts

# Pythonä»®æƒ³ç’°å¢ƒã®ä½œæˆï¼ˆæ¨å¥¨ï¼‰
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# ã¾ãŸã¯
venv\Scripts\activate  # Windows

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# æ—¥æœ¬èªSentence-BERTãƒ¢ãƒ‡ãƒ«ã¨ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
python download_sentence_bert_ja.py
```

**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:**
- `assets/tokenizer/sentence_bert_ja/vocab.txt` (èªå½™ãƒ•ã‚¡ã‚¤ãƒ«)
- `assets/tokenizer/sentence_bert_ja/config.json` (è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«)
- Pythonç’°å¢ƒã« `sonoisa/sentence-bert-base-ja-mean-tokens-v2` ãƒ¢ãƒ‡ãƒ«

### 2. ãƒ¢ãƒ‡ãƒ«ã®TFLiteå¤‰æ›

```bash
# PyTorch â†’ TensorFlow â†’ TFLite ã¸ã®å¤‰æ›
python convert_to_tflite_v2.py
```

**ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:**
- `assets/models/sentence_bert_ja.tflite` (ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ¢ãƒ‡ãƒ«)

**å¤‰æ›ã®è©³ç´°:**
- å…¥åŠ›1: `attention_mask` (shape: [1, 128])
- å…¥åŠ›2: `input_ids` (shape: [1, 128])
- å‡ºåŠ›: `sentence_embedding` (shape: [1, 768])

### 3. Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š

`pubspec.yaml`ã«ä»¥ä¸‹ã®ã‚¢ã‚»ãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª:

```yaml
flutter:
  assets:
    - assets/models/sentence_bert_ja.tflite
    - assets/tokenizer/sentence_bert_ja/vocab.txt
```

### 4. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
cd /Users/mikayu/developing/taskEcho/front_end
flutter pub get
```

**ä¸»è¦ãªä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**
- `tflite_flutter: ^0.10.0` - TFLiteæ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³
- `provider: ^6.0.0` - çŠ¶æ…‹ç®¡ç†

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
front_end/
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ sentence_bert_ja.tflite          # TFLiteãƒ¢ãƒ‡ãƒ«ï¼ˆå¤‰æ›å¾Œï¼‰
â”‚   â””â”€â”€ tokenizer/
â”‚       â””â”€â”€ sentence_bert_ja/
â”‚           â”œâ”€â”€ vocab.txt                     # èªå½™ãƒ•ã‚¡ã‚¤ãƒ«
â”‚           â””â”€â”€ config.json                   # ãƒ¢ãƒ‡ãƒ«è¨­å®š
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ i_semantic_search_service.dart   # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ japanese_semantic_search_service.dart  # æ—¥æœ¬èªå®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ semantic_search_service.dart     # å¤šè¨€èªå®Ÿè£…
â”‚   â”‚   â””â”€â”€ keyword_detector_service.dart    # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡º
â”‚   â””â”€â”€ providers/
â”‚       â””â”€â”€ keywordProvider.dart             # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
â””â”€â”€ scripts/
    â”œâ”€â”€ download_sentence_bert_ja.py         # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â”œâ”€â”€ convert_to_tflite_v2.py             # å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â””â”€â”€ requirements.txt                     # Pythonä¾å­˜é–¢ä¿‚
```

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

1. **ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚**
   ```dart
   // keywordProvider ãŒè‡ªå‹•çš„ã«ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã‚’åˆæœŸåŒ–
   // ãƒ­ã‚°ã«ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹:
   // ğŸ”§ æ—¥æœ¬èªå°‚ç”¨ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨
   // âœ… æ—¥æœ¬èªãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–å®Œäº† (èªå½™: 31999èª)
   // âœ… æ—¥æœ¬èªã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢: åˆæœŸåŒ–å®Œäº†
   ```

2. **æ¤œå‡ºãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ**
   - **å®Œå…¨ä¸€è‡´ã®ã¿**: æœ€é€Ÿã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨å®Œå…¨ã«ä¸€è‡´ã™ã‚‹å ´åˆã®ã¿æ¤œå‡º
   - **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆæ¨å¥¨ï¼‰**: å®Œå…¨ä¸€è‡´ + ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢
   - **æ„å‘³çš„æ¤œç´¢ã®ã¿**: é¡ç¾©èªã‚„é–¢é€£èªã‚‚æ¤œå‡ºï¼ˆã‚„ã‚„é‡ã„ï¼‰

3. **é¡ä¼¼åº¦é–¾å€¤ã®èª¿æ•´**
   - 0.5ã€œ0.95ã®ç¯„å›²ã§èª¿æ•´å¯èƒ½
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.7 (70%)
   - é«˜ã„å€¤ â†’ å³å¯†ãªæ¤œå‡º
   - ä½ã„å€¤ â†’ å¹…åºƒã„æ¤œå‡º

### ã‚³ãƒ¼ãƒ‰ã§ã®ä½¿ç”¨ä¾‹

```dart
// KeywordProviderã®å–å¾—
final keywordProvider = Provider.of<KeywordProvider>(context);

// ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã‚’ä½¿ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡º
final detections = await keywordProvider.detectKeywordsSemantic(
  'æ¥é€±ãƒ†ã‚¹ãƒˆãŒã‚ã‚Šã¾ã™'
);

// æ¤œå‡ºçµæœã®ç¢ºèª
for (final detection in detections) {
  print('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${detection.keyword}');
  print('ä¸€è‡´ãƒ†ã‚­ã‚¹ãƒˆ: ${detection.matchedText}');
  print('é¡ä¼¼åº¦: ${detection.similarity}');
}
```

---

## ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### å®Ÿè£…æ¸ˆã¿ã®æœ€é©åŒ–

1. **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ã‚¯ãƒˆãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥**
   - åŒã˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ä¸€åº¦ã ã‘ãƒ™ã‚¯ãƒˆãƒ«åŒ–
   - ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªå†åˆ©ç”¨

2. **ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ•°ã®åˆ¶é™**
   - æœ€å¤§10ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¾ã§å‡¦ç†
   - é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã§ã‚‚é«˜é€Ÿ

3. **çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¹ã‚­ãƒƒãƒ—**
   - 3æ–‡å­—æœªæº€ã¯å‡¦ç†ã—ãªã„

4. **UIå¿œç­”æ€§ã®ä¿æŒ**
   - å„å‡¦ç†ã®é–“ã«çŸ­ã„é…å»¶ã‚’æŒ¿å…¥

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–ã®è¨­å®š

```dart
// å®Œå…¨ä¸€è‡´ãƒ¢ãƒ¼ãƒ‰ã®ã¿ä½¿ç”¨ï¼ˆæœ€é€Ÿï¼‰
keywordProvider.setDetectionMode('exact');

// ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã§é–¾å€¤ã‚’é«˜ã‚ã«è¨­å®š
keywordProvider.setDetectionMode('hybrid');
keywordProvider.setSimilarityThreshold(0.8);
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¢ãƒ‡ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼

```
Error: Unable to load asset: assets/models/sentence_bert_ja.tflite
```

**è§£æ±ºç­–:**
1. `convert_to_tflite_v2.py` ã‚’å®Ÿè¡Œã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ç”Ÿæˆ
2. `flutter clean && flutter pub get` ã‚’å®Ÿè¡Œ
3. ã‚¢ãƒ—ãƒªã‚’å†ãƒ“ãƒ«ãƒ‰

### ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼

```
âŒ ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–å¤±æ•—
```

**è§£æ±ºç­–:**
1. `assets/tokenizer/sentence_bert_ja/vocab.txt` ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
2. `download_sentence_bert_ja.py` ã‚’å†å®Ÿè¡Œ
3. `pubspec.yaml` ã«ã‚¢ã‚»ãƒƒãƒˆãƒ‘ã‚¹ãŒæ­£ã—ãè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### TFLiteæ¨è«–ã‚¨ãƒ©ãƒ¼

```
âŒ ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã‚¨ãƒ©ãƒ¼
```

**è§£æ±ºç­–:**
1. ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ãªã„ã‹ç¢ºèªï¼ˆç´„300MBï¼‰
2. TFLiteã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª: `tflite_flutter: ^0.10.0`
3. ãƒ¢ãƒ‡ãƒ«ã‚’å†å¤‰æ›: `python convert_to_tflite_v2.py`

### ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–:**
1. å®Œå…¨ä¸€è‡´ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
2. é¡ä¼¼åº¦é–¾å€¤ã‚’ä¸Šã’ã‚‹ï¼ˆ0.8ä»¥ä¸Šï¼‰
3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ï¼ˆã‚¢ãƒ—ãƒªå†èµ·å‹•ï¼‰

---

## ğŸ“Š ãƒ¢ãƒ‡ãƒ«æƒ…å ±

### ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«
- **åå‰**: `sonoisa/sentence-bert-base-ja-mean-tokens-v2`
- **ãƒ™ãƒ¼ã‚¹**: BERT (æ—¥æœ¬èªWikipediaå­¦ç¿’æ¸ˆã¿)
- **èªå½™ã‚µã‚¤ã‚º**: 31,999èª
- **åŸ‹ã‚è¾¼ã¿æ¬¡å…ƒ**: 768
- **æœ€å¤§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·**: 128ãƒˆãƒ¼ã‚¯ãƒ³

### ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
- MIT License
- å•†ç”¨åˆ©ç”¨å¯èƒ½

---

## ğŸ”„ æ›´æ–°ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°

```bash
cd /Users/mikayu/developing/taskEcho/front_end/scripts

# æœ€æ–°ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
python download_sentence_bert_ja.py

# å†å¤‰æ›
python convert_to_tflite_v2.py

# Flutterã‚¢ãƒ—ãƒªã®å†ãƒ“ãƒ«ãƒ‰
cd ..
flutter clean
flutter pub get
flutter run
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢

```dart
// ã‚³ãƒ¼ãƒ‰ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
keywordProvider._keywordDetectorService.clearCache();
```

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Sentence-BERTå…¬å¼](https://www.sbert.net/)
- [TFLite Flutter Plugin](https://pub.dev/packages/tflite_flutter)
- [Hugging Face - sonoisa/sentence-bert-base-ja-mean-tokens-v2](https://huggingface.co/sonoisa/sentence-bert-base-ja-mean-tokens-v2)

---

## âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†
- [ ] `requirements.txt` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†
- [ ] ãƒ¢ãƒ‡ãƒ«ã¨ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†
- [ ] TFLiteãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›å®Œäº†
- [ ] `pubspec.yaml` ã®è¨­å®šç¢ºèª
- [ ] `flutter pub get` å®Ÿè¡Œ
- [ ] ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«åˆæœŸåŒ–ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºãŒå‹•ä½œã™ã‚‹

å…¨ã¦å®Œäº†ã—ãŸã‚‰ã€æ—¥æœ¬èªã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ãŒä½¿ãˆã¾ã™ï¼ğŸ‰
